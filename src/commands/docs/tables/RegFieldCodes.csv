# ModR/M Byte Layout
-----------------------------------------------------
Mod[7:6] R[5:3] RM[2:0]


So:

Example: 

The instruction CMP(r/m8, r8) has op code {38 /r}

Consider the byte CE:


# Encoding with and without the ModRM w field in non-64 bit mode  *WE = w field is present
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| reg | size | 64-bit | WE | w = 0 | w = 1 |
| 000 | 16   | N      | Y  | AL    | AX    |
| 001 | 16   | N      | Y  | CL    | CX    |
| 010 | 16   | N      | Y  | DL    | DX    |
| 011 | 16   | N      | Y  | BL    | BX    |
| 100 | 16   | N      | Y  | AH    | SP    |
| 101 | 16   | N      | Y  | CH    | BP    |
| 110 | 16   | N      | Y  | DH    | SI    |
| 111 | 16   | N      | Y  | BH    | DI    |
| 000 | 32   | N      | Y  | AL    | EAX   |
| 001 | 32   | N      | Y  | CL    | ECX   |
| 010 | 32   | N      | Y  | DL    | EDX   |
| 011 | 32   | N      | Y  | BL    | EBX   |
| 100 | 32   | N      | Y  | AH    | ESP   |
| 101 | 32   | N      | Y  | CH    | EBP   |
| 110 | 32   | N      | Y  | DH    | ESI   |
| 111 | 32   | N      | Y  | BH    | EDI   |
| 000 | 16   | N      | N  | AX    |       |
| 001 | 16   | N      | N  | CX    |       |
| 010 | 16   | N      | N  | DX    |       |
| 011 | 16   | N      | N  | BX    |       |
| 100 | 16   | N      | N  | SP    |       |
| 101 | 16   | N      | N  | BP    |       |
| 110 | 16   | N      | N  | SI    |       |
| 111 | 16   | N      | N  | DI    |       |
| 000 | 32   | N      | N  | EAX   |       |
| 001 | 32   | N      | N  | ECX   |       |
| 010 | 32   | N      | N  | EDX   |       |
| 011 | 32   | N      | N  | EBX   |       |
| 100 | 32   | N      | N  | ESP   |       |
| 101 | 32   | N      | N  | EBP   |       |
| 110 | 32   | N      | N  | ESI   |       |
| 111 | 32   | N      | N  | EDI   |       |





# Encoding of reg Field When Mod/RM w Field is Not Present in Instruction; non 64-bit modes
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| Code | Register Selected for 16-Bit Data Ops | Register Selected for 32-Bit Data Ops |
| 000  | AX                                    | EAX                                   |
| 001  | CX                                    | ECX                                   |
| 010  | DX                                    | EDX                                   |
| 011  | BX                                    | EBX                                   |
| 100  | SP                                    | ESP                                   |
| 101  | BP                                    | EBP                                   |
| 110  | SI                                    | ESI                                   |
| 111  | DI                                    | EDI                                   |

# Register Specified by reg Field During 16-Bit Data Operations When Mod/RM w Field is Present in Instruction; non 64-bit modes
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| reg | w = 0 | w = 1 |
| 000 | AL    | AX    |
| 001 | CL    | CX    |
| 010 | DL    | DX    |
| 011 | BL    | BX    |
| 100 | AH    | SP    |
| 101 | CH    | BP    |
| 110 | DH    | SI    |
| 111 | BH    | DI    |

# Register Specified by reg Field During 32-Bit Data Operations When Mod/RM w Field is Present in Instruction; non 64-bit modes
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| reg | w = 0 | w = 1 |
| 000 | AL    | EAX   |
| 001 | CL    | ECX   |
| 010 | DL    | EDX   |
| 011 | BL    | EBX   |
| 100 | AH    | ESP   |
| 101 | CH    | EBP   |
| 110 | DH    | ESI   |
| 111 | BH    | EDI   |

# Encoding of reg Field When Mod/RM w Field is Not Present in Instruction; 64-bit mode
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| reg | Register Selected for 16-Bit Data Ops | Register Selected for 32-Bit Data Ops | Register Selected for 64-Bit Data Ops |
| 000 | AX                                    | EAX                                   | RAX                                   |
| 001 | CX                                    | ECX                                   | RCX                                   |
| 010 | DX                                    | EDX                                   | RDX                                   |
| 011 | BX                                    | EBX                                   | RBX                                   |
| 100 | SP                                    | ESP                                   | RSP                                   |
| 101 | BP                                    | EBP                                   | RBP                                   |
| 110 | SI                                    | ESI                                   | RSI                                   |
| 111 | DI                                    | EDI                                   | RDI                                   |

# Register Specified by reg Field During 16-Bit Data Operations
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| reg | w = 0 | w = 1 | Notes                                   |
| 000 | AL    | AX    |                                         |
| 001 | CL    | CX    |                                         |
| 010 | DL    | DX    |                                         |
| 011 | BL    | BX    |                                         |
| 100 | AH    | SP    | Cannot be encoded if REX prefix is used |
| 101 | CH    | BP    | Cannot be encoded if REX prefix is used |
| 110 | DH    | SI    | Cannot be encoded if REX prefix is used |
| 111 | BH    | DI    | Cannot be encoded if REX prefix is used |

# Register Specified by reg Field During 32-Bit Data Operations
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| reg | w = 0 | w = 1 | Notes                                   |
| 000 | AL    | EAX   |                                         |
| 001 | CL    | ECX   |                                         |
| 010 | DL    | EDX   |                                         |
| 011 | BL    | EBX   |                                         |
| 100 | AH    | ESP   | Cannot be encoded if REX prefix is used |
| 101 | CH    | EBP   | Cannot be encoded if REX prefix is used |
| 110 | DH    | ESI   | Cannot be encoded if REX prefix is used |
| 111 | BH    | EDI   | Cannot be encoded if REX prefix is used |

# 2-bit Segment Register fields
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| reg | Selected |
| 00  | ES       |
| 01  | CS       |
| 10  | SS       |
| 11  | DS       |


# 3-bit Segment Register fields
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| reg | Selected |
| 000 | ES       |
| 001 | CS       |
| 010 | SS       |
| 011 | DS       |
| 100 | FS       |
| 101 | GS       |